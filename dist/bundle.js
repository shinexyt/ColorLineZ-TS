!function t(e,i,o){function s(r,n){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!n&&h)return h(r,!0);if(a)return a(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var d=i[r]={exports:{}};e[r][0].call(d.exports,function(t){var i=e[r][1][t];return s(i||t)},d,d.exports,t,e,i,o)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<o.length;r++)s(o[r]);return s}({1:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=t("./node"),s=function(){function t(t,e){this.data=[],this.openArea=[],this.paths=[],this.closeArea={},this.cache={},this.startNode=null,this.endNode=null,this.costEnergy_S=10,this.costEnergy_L=14,this.gridColumns=t,this.gridRows=t,this.gridSize=e,this.data=[];for(var i=0;i<this.gridColumns;i++){for(var s=[],a=0;a<this.gridColumns;a++){var r=new o.Node(this.gridSize*a+this.gridSize/2,this.gridSize*i+this.gridSize/2);this.cache[r.id]=r,s.push(r)}this.data.push(s)}}return t.prototype.getNode=function(t,e){return this.cache["map_"+t+"_"+e]},t.prototype.setStartNode=function(t){this.startNode=t},t.prototype.setEndNode=function(t){this.endNode=t},t.prototype.isOpenAreaExitNode=function(t){for(var e=this.openArea,i=0;i<e.length;i++)if(e[i].id===t.id)return e[i];return null},t.prototype.getPath=function(){this.getAroundNode(this.startNode),0!=this.openArea.length&&(this.search(this.endNode),this.doPaths(this.endNode))},t.prototype.search=function(t){for(;!this.closeArea[t.id];){var e=this.getFMin();if(!e)break;this.getAroundNode(e),this.search(t)}},t.prototype.doPaths=function(t){this.closeArea[t.id]&&this.drawRoad(t)},t.prototype.drawRoad=function(t){this.paths.push(t),t.prev!==this.startNode&&this.drawRoad(t.prev)},t.prototype.getFMin=function(){return 0==this.openArea.length?null:(this.orderOpenArea(),this.closeArea[this.openArea[0].id]=this.openArea[0],this.openArea.shift())},t.prototype.orderOpenArea=function(){this.openArea.sort(function(t,e){return t.fObj.F-e.fObj.F})},t.prototype.resetArea=function(){this.openArea=[],this.closeArea={};for(var t=0;t<this.gridRows;t++)for(var e=0;e<this.gridColumns;e++){var i="map_"+(this.gridSize*e+this.gridSize/2)+"_"+(this.gridSize*t+this.gridSize/2),o=this.cache[i];!0===o.isRoadBlock&&(this.closeArea[i]=o)}},t.prototype.getAroundNode=function(t){for(var e,i,o=this.gridRows,s=this.gridColumns,a=-1*this.gridSize;a<=this.gridSize;a+=this.gridSize){e=t.x+a;for(var r=-1*this.gridSize;r<=this.gridSize;r+=this.gridSize)if(i=t.y+r,(0!==a||0!==r)&&a*r==0&&e>0&&i>0&&e<=s*this.gridSize&&i<=o*this.gridSize){var n=this.getNode(e,i);if(Math.abs(a)==Math.abs(r)&&this.isCorner(n,{x:a,y:r}))continue;if(!this.closeArea[n.id]){var h=this.getF(t,n),l=this.isOpenAreaExitNode(n);if(l&&l.fObj.G<=h.G)continue;n.fObj=h,n.prev=t,this.openArea.push(n)}}}},t.prototype.getF=function(t,e){var i=Math.abs(this.endNode.x-e.x)*this.costEnergy_S+Math.abs(this.endNode.y-e.y)*this.costEnergy_S,o=Math.abs(e.x-t.x)===Math.abs(e.y-t.y)?this.costEnergy_L:this.costEnergy_S;return t.fObj&&(o=t.fObj.G+o),{F:i+o,H:i,G:o}},t.prototype.isCorner=function(t,e){var i=this.closeArea,o=e.x,s=e.y,a=this.getNode;if(Math.abs(o)===Math.abs(s)){if(o>0&&s<0)return i[a(t.x,t.y+1).id]||i[a(t.x-1,t.y).id];if(o<0&&s>0)return i[a(t.x,t.y-1).id]||i[a(t.x+1,t.y).id];if(o===s&&o>0)return i[a(t.x,t.y-1).id]||i[a(t.x-1,t.y).id];if(o===s&&o<0)return i[a(t.x,t.y+1).id]||i[a(t.x+1,t.y).id]}},t}();i.Map=s},{"./node":6}],2:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=t("./a-star-map"),s=t("./common-method"),a=function(){function t(t,e){var i=this;this.num=0,this.num1=0,this.result=0,this.colors=["red","blue","orange","green","brown"],this.eliminatedBalls=[],this.ballRadius=13,this.score=0,this.stopMoveAnimation=null,this.stopJump=null,this.stopRemove=null,this.click=function(t){var e=i.getMousePos(t),o=i.map.getNode(e.x,e.y);if(o)if(o.isRoadBlock)cancelAnimationFrame(i.stopJump),i.map.startNode&&(i.RemoveBall(i.map.startNode.x,i.map.startNode.currentY),i.CreateBall(i.map.startNode.color,i.map.startNode.x,i.map.startNode.y)),i.map.setStartNode(o),i.SelectBall();else{if(!i.map.startNode)return void i.playSound("media/click-error.mp3");i.map.setEndNode(o),i.map.getPath(),i.map.paths.length>0?(cancelAnimationFrame(i.stopJump),i.RemoveBall(i.map.startNode.x,i.map.startNode.currentY),i.map.paths=i.SmoothPath(5),i.currentColor=i.map.startNode.color,i.map.startNode.color="",i.map.startNode.isRoadBlock=!1,i.num=1,i.playSound("media/run.mp3"),i.moveAnimation()):(i.playSound("media/click-error1.mp3"),i.map.resetArea())}},this.JumpBall=function(){i.RemoveBall(i.map.startNode.x,i.map.startNode.currentY),8==Math.abs(i.map.startNode.currentY-i.map.startNode.y)&&(i.map.startNode.flag*=-1),i.map.startNode.currentY+=i.map.startNode.flag,i.CreateBall(i.map.startNode.color,i.map.startNode.x,i.map.startNode.currentY),i.stopJump=requestAnimationFrame(i.JumpBall)},this.moveAnimation=function(){i.RemoveBall(i.map.paths[i.num-1].x,i.map.paths[i.num-1].y);var t=i.map.paths[i.num].x,e=i.map.paths[i.num].y;if(i.CreateBall(i.currentColor,t,e),i.num++,i.num>=i.map.paths.length){cancelAnimationFrame(i.stopMoveAnimation);var o=i.map.getNode(t,e);o.color=i.currentColor,o.isRoadBlock=!0,i.num=0,i.map.paths=[],i.map.startNode=null,i.checkResult(),i.map.resetArea()}else i.stopMoveAnimation=requestAnimationFrame(i.moveAnimation)},this.RemoveBalls=function(){i.RemoveBall(i.eliminatedBalls[i.num1].x,i.eliminatedBalls[i.num1].y),i.num1++,i.num1<i.eliminatedBalls.length?i.stopRemove=requestAnimationFrame(i.RemoveBalls):(i.num1=0,i.eliminatedBalls=[],cancelAnimationFrame(i.stopRemove))},this.gridSize=e,this.gridColumns=t,this.gridRows=t,this.map=new o.Map(t,e),this.canvas=document.getElementById("myCanvas"),this.context=this.canvas.getContext("2d"),this.canvas.addEventListener("click",this.click,!1);var s=document.getElementById("tipsCanvas");this.tipsContext=s.getContext("2d")}return t.prototype.Init=function(){this.CreateInitialBall(),this.GetNextColors()},t.prototype.CreateInitialBall=function(){for(var t=0;t<5;t++){var e=this.GetRandomColor(),i=this.GetRandomNum(),o=this.GetRandomNum(),a=this.map.getNode(i,o),r=s.CommonMethod.getId(i,o);a.isRoadBlock?t--:(a.isRoadBlock=!0,a.color=e,this.map.closeArea[r]=a,this.CreateBall(e,i,o))}},t.prototype.GetRandomColor=function(){return this.colors[Math.floor(5*Math.random())]},t.prototype.GetRandomNum=function(){return this.gridSize*Math.floor(9*Math.random())+this.gridSize/2},t.prototype.CreateBall=function(t,e,i){var o=this.context.createRadialGradient(e-2,i-2,1,e,i,10);o.addColorStop(1,t),o.addColorStop(0,"white"),this.context.fillStyle=o,this.context.beginPath(),this.context.arc(e,i,this.ballRadius,0,2*Math.PI),this.context.fill()},t.prototype.GetNextColors=function(){this.nextColors=[],this.nextColors.push(this.colors[Math.floor(5*Math.random())]),this.nextColors.push(this.colors[Math.floor(5*Math.random())]),this.nextColors.push(this.colors[Math.floor(5*Math.random())]),this.CreateTipsBall(this.nextColors[0],15,15),this.CreateTipsBall(this.nextColors[1],45,15),this.CreateTipsBall(this.nextColors[2],75,15)},t.prototype.CreateTipsBall=function(t,e,i){var o=this.tipsContext.createRadialGradient(e-2,i-2,1,e,i,10);o.addColorStop(1,t),o.addColorStop(0,"white"),this.tipsContext.fillStyle=o,this.tipsContext.beginPath(),this.tipsContext.arc(e,i,this.ballRadius,0,2*Math.PI),this.tipsContext.fill()},t.prototype.getMousePos=function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left*(this.canvas.width/e.width),o=t.clientY-e.top*(this.canvas.height/e.height),s=this.gridSize;return{x:Math.ceil(i/s)*s-s/2,y:Math.ceil(o/s)*s-s/2}},t.prototype.RemoveBall=function(t,e){var i=this.ballRadius;this.context.clearRect(t-i,e-i,2*i,2*i)},t.prototype.SelectBall=function(){this.playSound("media/click.mp3"),this.map.startNode.currentY=this.map.startNode.y,this.map.startNode.flag=1,this.JumpBall()},t.prototype.playSound=function(t){new Audio(t).play()},t.prototype.SmoothPath=function(t){this.map.paths.reverse();var e=[],i=this.gridSize/t;this.map.paths.unshift({x:this.map.startNode.x,y:this.map.startNode.y});for(var o=1;o<this.map.paths.length;o++)if(e.push({x:this.map.paths[o-1].x,y:this.map.paths[o-1].y}),this.map.paths[o-1].x===this.map.paths[o].x){s=1;this.map.paths[o-1].y>this.map.paths[o].y&&(s=-1);for(a=1;a<t;a++)e.push({x:this.map.paths[o-1].x,y:this.map.paths[o-1].y+s*a*i})}else{var s=1;this.map.paths[o-1].x>this.map.paths[o].x&&(s=-1);for(var a=1;a<t;a++)e.push({x:this.map.paths[o-1].x+s*a*i,y:this.map.paths[o-1].y})}return e.push({x:this.map.paths[this.map.paths.length-1].x,y:this.map.paths[this.map.paths.length-1].y}),e},t.prototype.checkResult=function(){this.getEliminatedBalls(),this.eliminatedBalls.length>=4?(this.eliminatedBalls.length+1==5?this.score+=10:(this.getScore(10),this.score+=this.result,this.result=0),document.getElementById("scoreboard").innerText=this.score.toString(),this.ClearPathBalls()):(this.eliminatedBalls=[],this.CreateNextBall(),this.GetNextColors())},t.prototype.getEliminatedBalls=function(){for(var t=this.map.endNode,e=[],i=[],o=[],a=[],r=-1;r<2;r++)for(var n=-1;n<2;n++)if(0!=r||0!=n)for(var h=1;h<9&&(t.x+r*h*this.gridSize>0&&t.x+r*h*this.gridSize<380&&t.y+n*h*this.gridSize>0&&t.y+n*h*this.gridSize<380);h++){var l=this.map.cache[s.CommonMethod.getId(t.x+r*h*this.gridSize,t.y+n*h*this.gridSize)];if(l.color!=t.color)break;2==Math.abs(r+n)?a.push(l):0==Math.abs(r+n)?o.push(l):0==r?i.push(l):e.push(l)}e.length>=4&&(this.eliminatedBalls=this.eliminatedBalls.concat(e)),i.length>=4&&(this.eliminatedBalls=this.eliminatedBalls.concat(i)),o.length>=4&&(this.eliminatedBalls=this.eliminatedBalls.concat(o)),a.length>=4&&(this.eliminatedBalls=this.eliminatedBalls.concat(a))},t.prototype.getScore=function(t){this.num++,this.result=t+4*this.num-2,this.num<this.eliminatedBalls.length+1-5?this.getScore(this.result):this.num=0},t.prototype.ClearPathBalls=function(){this.playSound("media/bingo.mp3"),this.map.endNode.color="",this.map.endNode.isRoadBlock=!1;for(var t=0;t<this.eliminatedBalls.length;t++)this.eliminatedBalls[t].isRoadBlock=!1,this.eliminatedBalls[t].color="";this.RemoveBall(this.map.endNode.x,this.map.endNode.y),this.RemoveBalls()},t.prototype.CreateNextBall=function(){for(var t=0;t<3;t++){var e=this.nextColors[t],i=this.GetRandomNum(),o=this.GetRandomNum(),a=this.map.getNode(i,o),r=s.CommonMethod.getId(i,o);if(a.isRoadBlock)t--;else{if(a.isRoadBlock=!0,a.color=e,this.map.closeArea[r]=a,this.CheckIsGameOver()){alert("Game Over!"),window.location.reload();break}this.CreateBall(e,i,o),this.map.setEndNode(a),this.autoCheckResult()}}},t.prototype.CheckIsGameOver=function(){var t=0;for(var e in this.map.closeArea)t++;return t===this.gridColumns*this.gridRows},t.prototype.autoCheckResult=function(){this.getEliminatedBalls(),this.eliminatedBalls.length>=4?this.ClearPathBalls():this.eliminatedBalls=[]},t}();i.Action=a},{"./a-star-map":1,"./common-method":4}],3:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(t,e){this.gridColumns=t,this.gridSize=e}return t.prototype.drawRect=function(){for(var t=document.getElementById("bgCanvas").getContext("2d"),e=this.gridColumns*this.gridSize,i=0;i<=e;i+=this.gridSize)t.beginPath(),t.moveTo(0,i),t.lineTo(e,i),t.stroke(),t.closePath(),t.beginPath(),t.moveTo(i,0),t.lineTo(i,e),t.stroke(),t.closePath()},t}();i.MyCanvas=o},{}],4:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=function(){function t(){}return t.getId=function(t,e){return"map_"+t+"_"+e},t}();i.CommonMethod=o},{}],5:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=t("./canvas"),s=t("./action");document.bgColor="beige",new o.MyCanvas(9,40).drawRect(),new s.Action(9,40).Init()},{"./action":2,"./canvas":3}],6:[function(t,e,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=t("./common-method"),s=function(){return function(t,e){this.isRoadBlock=!1,this.prev=null,this.fObj=null,this.color="",this.x=t,this.y=e,this.id=o.CommonMethod.getId(t,e)}}();i.Node=s},{"./common-method":4}]},{},[5]);
//# sourceMappingURL=bundle.js.map
